#include <SPI.h>
#include <stdlib.h>
#include <string.h>
#include <FS.h>
#include "clock.h"
#include "fish.h"

const int CS  = D8;
const int DCX = D4;
const int RST = D3;

SPISettings SPIparams(32000000, MSBFIRST, SPI_MODE0);

void setup() {
  Serial.begin(9600);
  pinMode (CS, OUTPUT);
  pinMode (DCX, OUTPUT);
  pinMode(RST, OUTPUT);
  
  bool success = SPIFFS.begin();
  if (!success) {
    Serial.println("Error mounting the file system");
    return;
  }
  
  delay(1000);
  
  SPI.begin();
  disp_init();
  delay(1000);
}

char buf[5];

void loop() {
  test_pic();
  delay(5000);
}

void disp_init(void){
  SPI.beginTransaction(SPIparams);
  boe_init();
  SPI.endTransaction();  
}

void reset(void){
  digitalWrite(RST,LOW);
  delay(20);
  digitalWrite(RST,HIGH);
  delay(15);
}

void spi_command_wr(uint8_t cmd){
  digitalWrite(CS, LOW);
  digitalWrite(DCX, LOW);
  SPI.transfer(cmd);
  digitalWrite(DCX, HIGH);
  digitalWrite(CS, HIGH);
}

void spi_parameter_wr(uint8_t data){
  digitalWrite(CS, LOW);
  digitalWrite(DCX, HIGH);
  SPI.transfer(data);
  digitalWrite(DCX, HIGH);
  digitalWrite(CS, HIGH);
}
void spi_parameter_wr16(uint16_t data){
  digitalWrite(CS, LOW);
  digitalWrite(DCX, HIGH);
  SPI.transfer16(data);
  digitalWrite(DCX, HIGH);
  digitalWrite(CS, HIGH);
}

void boe_init(void){
  reset();
  spi_command_wr(0xDF);
  spi_parameter_wr(0x98);
  spi_parameter_wr(0x54);
  spi_parameter_wr(0xEC);
  spi_command_wr(0xDE);
  spi_parameter_wr(0x00);
  spi_command_wr(0xB2);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x3D);
  spi_command_wr(0xB4);
  spi_parameter_wr(0x24);
  spi_command_wr(0xB7);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0xC8);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0xC8);
  spi_parameter_wr(0x00);
  spi_command_wr(0xB9);
  spi_parameter_wr(0x33);
  spi_parameter_wr(0x3A);
  spi_command_wr(0xBB);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x0E);
  spi_parameter_wr(0x43);
  spi_parameter_wr(0x43);
  spi_parameter_wr(0x21);
  spi_parameter_wr(0x21);
  spi_command_wr(0xCF);
  spi_parameter_wr(0x09);
  spi_parameter_wr(0x2E);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x0A);
  spi_command_wr(0xD7);
  spi_parameter_wr(0x20);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_command_wr(0xC8);
  spi_parameter_wr(0x7F);
  spi_parameter_wr(0x63);
  spi_parameter_wr(0x52);
  spi_parameter_wr(0x46);
  spi_parameter_wr(0x44);
  spi_parameter_wr(0x33);
  spi_parameter_wr(0x38);
  spi_parameter_wr(0x23);
  spi_parameter_wr(0x3D);
  spi_parameter_wr(0x3D);
  spi_parameter_wr(0x3E);
  spi_parameter_wr(0x60);
  spi_parameter_wr(0x4E);
  spi_parameter_wr(0x53);
  spi_parameter_wr(0x47);
  spi_parameter_wr(0x42);
  spi_parameter_wr(0x36);
  spi_parameter_wr(0x22);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x7F);
  spi_parameter_wr(0x63);
  spi_parameter_wr(0x52);
  spi_parameter_wr(0x46);
  spi_parameter_wr(0x44);
  spi_parameter_wr(0x33);
  spi_parameter_wr(0x38);
  spi_parameter_wr(0x23);
  spi_parameter_wr(0x3D);
  spi_parameter_wr(0x3D);
  spi_parameter_wr(0x3E);
  spi_parameter_wr(0x60);
  spi_parameter_wr(0x4E);
  spi_parameter_wr(0x53);
  spi_parameter_wr(0x47);
  spi_parameter_wr(0x42);
  spi_parameter_wr(0x36);
  spi_parameter_wr(0x22);
  spi_parameter_wr(0x01);
  spi_command_wr(0xE6);
  spi_parameter_wr(0x32);
  spi_parameter_wr(0x80);
  spi_parameter_wr(0x00);
  spi_command_wr(0xDE);
  spi_parameter_wr(0x04);
  spi_command_wr(0xB5);
  spi_parameter_wr(0x10);
  spi_command_wr(0xB8);
  spi_parameter_wr(0x50);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x03);
  spi_parameter_wr(0x14);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x5E);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x5E);
  spi_parameter_wr(0xE7);
  spi_parameter_wr(0x11);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x6C);
  spi_parameter_wr(0x11);
  spi_parameter_wr(0x89);
  spi_parameter_wr(0xF1);
  spi_parameter_wr(0x22);
  spi_parameter_wr(0x19);
  spi_parameter_wr(0x74);
  spi_parameter_wr(0x22);
  spi_parameter_wr(0x93);
  spi_parameter_wr(0xF9);
  spi_parameter_wr(0x33);
  spi_parameter_wr(0x19);
  spi_parameter_wr(0x7F);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_command_wr(0xB9);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x20);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x22);
  spi_parameter_wr(0x8D);
  spi_parameter_wr(0xBF);
  spi_parameter_wr(0x32);
  spi_parameter_wr(0xD0);
  spi_parameter_wr(0x02);
  spi_parameter_wr(0x33);
  spi_parameter_wr(0x12);
  spi_parameter_wr(0x44);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x0A);
  spi_command_wr(0xBA);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x07);
  spi_parameter_wr(0x07);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x07);
  spi_parameter_wr(0x07);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x07);
  spi_parameter_wr(0x07);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x03);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0xB4);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0xB3);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_command_wr(0xBB);
  spi_parameter_wr(0x14);
  spi_parameter_wr(0x66);
  spi_parameter_wr(0x66);
  spi_parameter_wr(0xA0);
  spi_parameter_wr(0x02);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x7F);
  spi_parameter_wr(0x60);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0xC0);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_command_wr(0xBC);
  spi_parameter_wr(0x18);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0xA0);
  spi_parameter_wr(0x06);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0xED);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x2C);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0xED);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x2C);
  spi_parameter_wr(0x82);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x03);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0xED);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x2C);
  spi_command_wr(0xC3);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_command_wr(0xC4);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_command_wr(0xC5);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0xE0);
  spi_parameter_wr(0xE9);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x39);
  spi_parameter_wr(0x38);
  spi_parameter_wr(0x36);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x15);
  spi_parameter_wr(0xD6);
  spi_parameter_wr(0x35);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_command_wr(0xC6);
  spi_parameter_wr(0x40);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0xE1);
  spi_parameter_wr(0xE2);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x39);
  spi_parameter_wr(0x38);
  spi_parameter_wr(0x37);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x15);
  spi_parameter_wr(0xD6);
  spi_parameter_wr(0x34);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_command_wr(0xC7);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0xE0);
  spi_parameter_wr(0xE9);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x1E);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x39);
  spi_parameter_wr(0x38);
  spi_parameter_wr(0x37);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x15);
  spi_parameter_wr(0xD6);
  spi_parameter_wr(0x35);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_command_wr(0xC8);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0xE1);
  spi_parameter_wr(0xE2);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x1E);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x39);
  spi_parameter_wr(0x38);
  spi_parameter_wr(0x36);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x15);
  spi_parameter_wr(0xD6);
  spi_parameter_wr(0x34);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_parameter_wr(0x1F);
  spi_command_wr(0xC9);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00); 
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x0C);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00); 
  spi_parameter_wr(0x00); 
  spi_parameter_wr(0x00); 
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_command_wr(0xED);
  spi_parameter_wr(0x02);
  spi_parameter_wr(0x34);
  spi_parameter_wr(0xF1);
  spi_parameter_wr(0x09);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x14);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x5B);
  spi_parameter_wr(0xF1);
  spi_command_wr(0xCA);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_command_wr(0xCB);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x20);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x03);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x02);
  spi_parameter_wr(0x03);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x02);
  spi_parameter_wr(0x22);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x03);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x21);
  spi_parameter_wr(0x23);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x06);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x10);
  spi_command_wr(0xCC);
  spi_parameter_wr(0x4F);
  spi_parameter_wr(0x11);
  spi_parameter_wr(0x47);
  spi_parameter_wr(0x47);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x02);
  spi_parameter_wr(0x02);
  spi_parameter_wr(0x87);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x03);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x03);
  spi_parameter_wr(0x03);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x02);
  spi_parameter_wr(0x09);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x02);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x02);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x02);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x02);
  spi_parameter_wr(0x05);
  spi_command_wr(0xCD);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x06);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x03);
  spi_command_wr(0xCE);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x31);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x73);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x04);
  spi_command_wr(0xCF);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x06);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x03);
  spi_command_wr(0xD0);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x31);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x05);
  spi_parameter_wr(0x73);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x04);
  spi_command_wr(0xD2);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x12);
  spi_parameter_wr(0x3C);
  spi_parameter_wr(0xD0);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x08);
  spi_parameter_wr(0x08);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x08);
  spi_parameter_wr(0x08);
  spi_parameter_wr(0x33);
  spi_parameter_wr(0x9D);
  spi_parameter_wr(0xB4);
  spi_parameter_wr(0x33);
  spi_parameter_wr(0x9D);
  spi_parameter_wr(0xB4);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x0D);
  spi_parameter_wr(0x9D);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x0D);
  spi_parameter_wr(0x9D);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x09);
  spi_parameter_wr(0xAC);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0xB1);
  spi_command_wr(0xD3);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x12);
  spi_parameter_wr(0x3C);
  spi_parameter_wr(0xD0);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x08);
  spi_parameter_wr(0x08);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x08);
  spi_parameter_wr(0x08);
  spi_parameter_wr(0x33);
  spi_parameter_wr(0x9D);
  spi_parameter_wr(0xB4);
  spi_parameter_wr(0x33);
  spi_parameter_wr(0x9D);
  spi_parameter_wr(0xB4);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x0D);
  spi_parameter_wr(0x9D);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x0D);
  spi_parameter_wr(0x9D);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x09);
  spi_parameter_wr(0xAC);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0xB1);
  spi_command_wr(0xD4);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x03);
  spi_parameter_wr(0x14);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x5E);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x5E);
  spi_parameter_wr(0xD1);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0xEF);
  spi_parameter_wr(0x56);
  spi_parameter_wr(0x11);
  spi_parameter_wr(0x74);
  spi_parameter_wr(0xDB);
  spi_parameter_wr(0x22);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x69);
  spi_parameter_wr(0x22);
  spi_parameter_wr(0x89);
  spi_parameter_wr(0xEF);
  spi_parameter_wr(0x33);
  spi_parameter_wr(0x0D);
  spi_parameter_wr(0x76);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_command_wr(0xD5);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x40);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0xEC);
  spi_parameter_wr(0x22);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x80);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x22);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x80);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_command_wr(0xD6);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x03);
  spi_parameter_wr(0x14);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x5E);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0xEF);
  spi_parameter_wr(0x56);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x5E);
  spi_parameter_wr(0xD1);
  spi_parameter_wr(0x22);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x69);
  spi_parameter_wr(0x11);
  spi_parameter_wr(0x74);
  spi_parameter_wr(0xDB);
  spi_parameter_wr(0x33);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x76);
  spi_parameter_wr(0x22);
  spi_parameter_wr(0x89);
  spi_parameter_wr(0xEF);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_command_wr(0xD7);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x40);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x67);
  spi_parameter_wr(0x21);
  spi_parameter_wr(0xF0);
  spi_parameter_wr(0x7A);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x22);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x80);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_command_wr(0xE6);
  spi_parameter_wr(0x09);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0xFC);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0xC0);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x0D);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x40);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0xFC);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x02);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x21);
  spi_parameter_wr(0x00);
  spi_command_wr(0xE7);
  spi_parameter_wr(0x08);
  spi_parameter_wr(0x20);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_command_wr(0xEC);
  spi_parameter_wr(0x09);
  spi_parameter_wr(0x10);
  spi_parameter_wr(0xC0);
  spi_command_wr(0xBE);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x5E);
  spi_parameter_wr(0xE7);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x04);
  spi_parameter_wr(0x6C);
  spi_parameter_wr(0x11);
  spi_parameter_wr(0x89);
  spi_parameter_wr(0xF1);
  spi_parameter_wr(0x12);
  spi_parameter_wr(0x19);
  spi_parameter_wr(0x74);
  spi_parameter_wr(0x22);
  spi_parameter_wr(0x93);
  spi_parameter_wr(0xF9);
  spi_parameter_wr(0x23);
  spi_parameter_wr(0x19);
  spi_parameter_wr(0x7F);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0xBC);
  spi_parameter_wr(0xD5);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0xDA);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_command_wr(0xBF);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x20);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x30);
  spi_parameter_wr(0x11);
  spi_parameter_wr(0x36);
  spi_parameter_wr(0x4F);
  spi_parameter_wr(0x11);
  spi_parameter_wr(0x54);
  spi_parameter_wr(0x6D);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x0A);
  spi_parameter_wr(0x00);
  spi_command_wr(0xEA);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x20);
  spi_parameter_wr(0x60);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x64);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x5A);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x23);
  spi_parameter_wr(0x65);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x64);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x5A);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x23);
  spi_parameter_wr(0x65);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x64);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x5A);
  spi_parameter_wr(0x00);
  spi_command_wr(0xEB);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x21);
  spi_parameter_wr(0x61);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x64);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x5A);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x21);
  spi_parameter_wr(0x61);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x64);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x5A);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x44);
  spi_parameter_wr(0x22);
  spi_command_wr(0xB2);
  spi_parameter_wr(0x13);
  spi_command_wr(0xDE);
  spi_parameter_wr(0x01);
  spi_command_wr(0xCA);
  spi_parameter_wr(0x01);
  spi_command_wr(0xDE);
  spi_parameter_wr(0x02);
  spi_command_wr(0xB2);
  spi_parameter_wr(0x08);
  spi_parameter_wr(0x18);
  spi_parameter_wr(0xA3);
  spi_parameter_wr(0x8E);
  spi_command_wr(0xDE);
  spi_parameter_wr(0x00);

  //Pixel Format - 0x06 - 18bits
  spi_command_wr(0x3A);
  spi_parameter_wr(0x01); //16bits/pixel
  
  spi_command_wr(0x51);
  spi_parameter_wr(0xFF); //Brightness Set 0xFF highest

  spi_command_wr(0x36); // memory access control
  spi_parameter_wr(0x28); //0048 my,mx,mv,ml,BGR,mh,0.0  //0x48 is BGR, 0x40 is RGB
  spi_command_wr(0x3a); // pixel format set
  spi_parameter_wr(0x05);//2bytes /pixel

  spi_command_wr(0x35);
  spi_parameter_wr(0x00);
  spi_command_wr(0x11);
  delay(120);
  spi_command_wr(0x29);
  delay(50);
}

void _1_hz_mode(void){
  SPI.beginTransaction(SPIparams);
  spi_command_wr(0xDE);
  spi_parameter_wr(0x03);
  spi_command_wr(0xB6);
  spi_parameter_wr(0x20);
  spi_command_wr(0x3A);
  spi_parameter_wr(0x05);
  spi_command_wr(0x2C);

  spi_command_wr(0xDE);
  spi_parameter_wr(0x04);
  spi_command_wr(0xE5);
  spi_parameter_wr(0x02);
  delay(50);

  SPI.endTransaction();
}

void test_pic(){
  
  SPI.beginTransaction(SPIparams);
  
  spi_command_wr(0x36); // memory access control
  spi_parameter_wr(0x28); //0048 my,mx,mv,ml,BGR,mh,0.0  //0x48 is BGR, 0x40 is RGB
  spi_command_wr(0x3a); // pixel format set
  spi_parameter_wr(0x05);//2bytes /pixel
  
  spi_command_wr(0x2a); // column set
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x3f);
  spi_command_wr(0x2b); // page address set
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x00);
  spi_parameter_wr(0x01);
  spi_parameter_wr(0x3f);
  
  spi_command_wr(0x2c); //memory write

  _1_hz_mode();
  spi_command_wr(0x2c); //memory write
  
  for (int i=0;i<(320*320);i++){
    spi_parameter_wr16(pgm_read_word_near(clock_face+i)); //Clock face picture display
  }
  delay(500);

  for (int i=0;i<(320*320);i++){
    spi_parameter_wr16(0xF800);   //Red filled frame
  }
  delay(500);
  
  for (int i=0;i<(320*320);i++){
    spi_parameter_wr16(pgm_read_word_near(fish+i)); //Fish picture display
  }
  delay(500);

  
  for (int i=0;i<(320*320);i++){
    spi_parameter_wr16(0xF800); //Red filled frame
  }
  delay(500);
  
  SPI.endTransaction(); 
}
